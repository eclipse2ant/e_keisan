コピペ君って最近は自分で読んでます。レシビなどWeb上にあるものをファイル
にコピペしたら、栄養計算してくれるソフトです。今回のバージョンから、
Excelは不要になりました。また、Windowsでなくても、MacでもLinuxでも使え
るようになりました。（ただし、私はMacは持ってないので、Macでの動作確認
はしていません)

Excelで書かれた成分表のデータにJavaのapache POIを使って、アクセスして
JRubyを使ってRubyのスクリプトを実行しています。JDKとJRubyをインストー
ルして下さい。Windowsの場合のインストールの仕方は、INSTALL.txt　に書か
れてます。
（http://barbra-coco.dyndns.org/eiyou/e_keisan-3/INSTALL.html )


　　　　　　　　　Windowsの場合

e_keisan-3-current.zip　展開して、とりあえず、ディストップに展開してく
ださい。新しく　e_keisan-3.0.x　というフォルダーができますのでクリック
してください。


e_keisan-3.0.x　という名前のウィンドウが開きますので、そのなかの
cmd.exe〔黒いアイコンのもの）をクリックすると、コマンドプロンプトが開
きます。以下このコマンドプロンプトで作業します。


このプロンプト上で、　

keisan demo.txt

と打って実行すると。demo.txtの中身が計算されて、カロリー計算してくれま
す。



　　　　　　　　　　Windows以外

e_keisan-3-current.zipまたはe_keisan-3-current.ta.gz
を展開して、

keisan.rb demo.txt　

を実行します


今回はたまたまdemo.txtを用いましたが、ご自分でエディター作られた、勝手
なファイルで構いません。書式はdemo.txtを参照下さい。尚、漢字コードは
utf-8を用いて下さい。WindowsでのデフォルトはShift-JISですが、保存する
際にutf-8で保存してください。


demo.txt　の中身は


納豆とにんじん入りハンバーグ[2]:
牛ひき肉（赤身）　　１５０ｇ
納豆　　５０ｇ
にんじん　　５０ｇ
万能ねぎ　　３０ｇ
パン粉　　大さじ２
塩　少々
こしょう　少々
#青じそ　　4枚
サラダ油　　小さじ２


なすのもみ漬け[2]:
なす　　１００ｇ
みそ　　小さじ１
練り辛子　　小さじ１／２
#バルスィート（カロリーゼロ）　　小さじ1/2

おにぎり2種[2]:
ごはん　３００ｇ
焼きのり　　1枚
梅干し　　　　小2個
しょうゆ　　1.5ｇ
だし汁　　1.5ｇ
しょうゆ　小さじ1/2


です。これによって出力されるのは、以下の出力例です。



＜出力例＞

納豆とにんじん入りハンバーグ[2]:
牛ひき肉(赤身) 150.0g
納豆 50.0g
にんじん 50.0g
万能ねぎ 30.0g
パン粉 8.0g
塩 0.5g
こしょう 0.2g
#青じそ 4枚
サラダ油 8.0g
----------------------------------
517.662 kcal (258.831 kcal)

(タンパク質;20.4696g)(塩分;0.39585g)
(DM交換表; 0.1865 0.0 2.415625 0.0 0.4605 0.168125 0.0)

なすのもみ漬け[2]:
なす 100.0g
みそ 6.0g
練り辛子 3.0g
#バルスィート(カロリーゼロ) 小さじ1/2
----------------------------------
42.61 kcal (21.305 kcal)

(タンパク質;1.0315g)(塩分;0.501g)
(DM交換表; 0.0 0.0 0.0 0.0 0.0 0.1375 0.06975)

おにぎり2種[2]:
ごはん 300.0g
焼きのり 3.0g
梅干し 12.0g
しょうゆ 1.5g
だし汁 1.5g
しょうゆ 3.0g
----------------------------------
516.825 kcal (258.4125 kcal)

(タンパク質;4.6005g)(塩分;1.6725g)
(DM交換表; 3.15 0.02475 0.0 0.0 0.0 0.0 0.0)

Total:1077.097 kcal (538.5485 kcal)

(タンパク質;26.1016g)(塩分;2.56935g)
(DM交換表; 3.3365 0.02475 2.415625 0.0 0.4605 0.305625 0.06975)


あと、すべての成分表の値を計算しています。今は表示させていませんが

Vector[538.5485, 2253.3495, 246.4485, 26.1016, 15.7932, 70.3928,
4.5989, 1014.14, 765.1275, 65.93, 79.5525, 287.2575, 3.72945, 5.03825,
0.44545, 0.0, 2737.565, 453.739, 0.0, 1.656, 240.28, 0.18151, 0.40588,
6.0027, 0.45865, 1.8435, 78.38, 2.4955, 8.551, 3.65085, 6.2517,
3.84005, 52.21, 1.096, 3.633, 5.269, 2.56935, 3.3365, 0.02475,
2.415625, 0.0, 0.4605, 0.305625] 


から、自由に表示させられます。Rubyは　Matrix module というのがあって、
これでベクトルが実現出きるので、ベクトルで計算させています。1行 n 列の
行列なので、行列計算を行って、将来的には、栄養判定、栄養指導も可能です。



----------------------------------------------------------------------



プログラムはできてますが、まだまだ、いろいろカスタマイズしてあげないと
いけない部分があります。次の二つの部分です。




1．gotei.listというファイルが、食品名と成分表のデータをつなぐインデッ
クスファイルになってますが、このインデックスファイルに載ってないと食品
がないといってしまいますので、名前をちゃんと載せてあげる必要があります。


gote.list　で、

りんご,りんご ,りんご 生,813


となっていれば、　りんご　という食材のデータは813にあるとわかりますが、
食品によっては、


,りんご ,りんご 生,813

と見出しが書かれてない場合があります。この場合　見出しを書いてあげれば、
数字を拾うことができます。（この数字が成分表のどこに書かれてるかを示す
数字です）半角カンマは重要でので、消さないでください。


また　リンゴで計算させたいときは、

りんご,りんご ,りんご 生,813
リンゴ,りんご ,りんご 生,813

のように、いろんな見出しを追加してあげても大丈夫です。好きな呼び名で、
その食材の数値を拾ってこれます。


りんご(皮あり),りんご ,りんご 生,813

という括弧も使えます。ただし必ず半角を使用してください。

〔注意）　レシビのファイルは、全角で書いてもかまいません。途中の処理で、
記号、英数字、空白文字は全て半角に変換しています。従って、gotei.list
では　半角で括弧を書かないと、文字列が一致せず、数字を拾ってくれなくて、
食品が見つからないというエラーになります。




2.　レシビなどではグラム書かれてなく　大1個とか書かれてます、これを自
動的にグラムに変換して計算するようにしてますが、この変換テーブルを作っ
てあげる必要があります。libフォルダーのなかのunitフォルダーを見ていた
だくと、何をやっているかわかると思いまが、。


例えば　りんご　大1個　 

なら　まず　大#個　に変換され　これに対応するファイルは　unit.rb に書いてます 
。取り決めてるのは、この場合は　　dai_ko になります。 そして、このファ
イル　dai_ko のなかに 


例えば　
 
りんご,60 

とか、書いてあるので、この数字を拾ってきます。

従って、こういう仕組みになっているので、いくらでも自由に変えられます。 

例えば、dai_ko ガない場合、大＃個との対応を定義してやって、そして、
dai_ko というファイルを作って、そのなかに　りんごの数値を書いてあげれ
ばよいわけです。 大抵は、ファイルがあって、そのファイルに　食品と数値
を書けばすむと思います。 





＊エラーメッセージが出るのは、次の４つです。

１．食品の見出しがない場合　----　上記の要領で、見出しをつけてください。
どこにつけるべきか検索は、メモ帳やエディターの検索や　grep.rb を使えば
できます。


grep.rb キーワード　gote.list

で探してくれます。

2. 単位のファイルがない場合。　　例えば　#羽　に対応するファイルがない
場合は、libフォルダーの


unit.rbに　

	@@u2f = {'大#'=>'dai_', '大#個'=>'dai_ko','小#個'=>'syo_ko', '適
           当'=>'tekitou', '適量'=>'tekiryo','適
           宜'=>'tekigi','#個'=>'_ko', '#本'=>'_hon','小#'=>'syo_', '#
           束'=>'_taba', '#cc'=>'_cc', '#ml'=>'_ml','大さじ
           #'=>'osaji_','小さじ#'=>'kosaji_', '#枚'=>'_mai','全形
           #枚'=>'zenkei_mai','少々'=>'syosyo' }

対応表が書かれているので、この中に　'#羽'=>'_wa'  を例えば


@@u2f = {'大#'=>'dai_', '大#個'=>'dai_ko','小#個'=>'syo_ko', '適
           当'=>'tekitou', '適量'=>'tekiryo','適
           宜'=>'tekigi','#個'=>'_ko', '#本'=>'_hon','小#'=>'syo_', '#
           束'=>'_taba', '#cc'=>'_cc', '#ml'=>'_ml','大さじ
           #'=>'osaji_','小さじ#'=>'kosaji_', '#枚'=>'_mai','全形
           #枚'=>'zenkei_mai','少々'=>'syosyo','#羽'=>'_wa' }

のように追加してください。（半角カンマを忘れないでください、いわゆる　
ハッシュ（連想配列）と呼ばれるものです。



3.　単位のファイルのなかに、その食材の記載がない場合　

リンゴ　大1個


で、dai_ko というファイルに、リンゴ,60  のように、対応するグラム数を半
角で記載してください、この際も半角カンマをつけることを忘れないでくださ
い。



なお、「計算しましょ」のExcelのファイルおよび、5訂データの扱いについて
は　大河内さんのweb　 


http://park12.wakwak.com/~dnss/keisan.htm 

を参照してください。


4.　レシビのファイル名を間違えた場合------ファイルが見つからないので、
見つからないというエラーが英語で表示されます


-----------------------------------------------------------------

＜必要なもの＞

エディター


＜使い方＞


demo.txt のようにメモ帳かエディターで書いて

keisan ファイル名

または

keisan.rb ファイル名

で結果が出力されます。


* なお、著作権は、GPL的なものを考えてます。
